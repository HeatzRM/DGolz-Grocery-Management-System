create table BuyingTransaction
(
BuyingTransID int identity (1001,1) primary key,
CheckoutID int,
StockSold numeric,
TransDate datetime,
ProductID int
)

create table Employee
(
EmployeeID int identity(1001,1) primary key,
FirstName varchar(50),
MiddleInitial varchar(50),
LastName varchar(50),
ContactNumber varchar(50),
Email varchar(50),
Address varchar(50),
UserName varchar(50),
Password varchar(50),
IsAdmin varchar(50)
)

create table Products
(
ProductID int identity(1001,1) primary key,
ProductName varchar(50),
ProductCode varchar(50),
ItemDesc varchar(50),
Price numeric
)


create table Supplier
(
SupplierID int identity(1001,1) primary key,
CompanyName varchar(50),
ContactNumber varchar(50),
SupplierAddress varchar(50),
Email varchar(50)
)

create table SupplyTrans
(
SupplyTransID int identity(1001,1) primary key,
ProductID int,
SupplierID int,
StockSupplied numeric
)

select * from BuyingTransaction
select * from Employee
select * from Products
select * from Supplier
select * from SupplyTrans



insert into Employee
(UserName,Password,IsAdmin)
values
(1,2,1)




 
 --Load Inventory
  Select NProduct.ProductID   , NProduct.ProductCode,  NProduct.ProductName,
	NProduct.Price,NProduct.ItemDesc,NSupplier.SupplierID,NSupplier.CompanyName ,TStockSup - TStockSold AS CurrentStocks 
	 from 
                    (Select Products.ProductID, Supplier.CompanyName ,Supplier.SupplierID,Supplier.SupplierID AS TSupplier From SupplyTrans 
                    inner join Products on Products.ProductID = SupplyTrans.ProductID  


                    inner join Supplier on Supplier.SupplierID = SupplyTrans.SupplierID
                    group by Products.ProductID, Supplier.CompanyName,Supplier.SupplierID,Supplier.SupplierID) AS NSupplier


                    inner join
                    (Select ProductID, ProductName ,ProductCode, Price ,ItemDesc,Price As TProduct From Products group by ProductID, 
                    ProductName , ProductCode, Price,ItemDesc,Price) As NProduct

                    Inner join 
                    (Select ProductID, sum(StockSold) AS TStockSold from BuyingTransaction group by ProductID) AS TotalStocksSold


                    inner join  
                    (Select ProductID, sum(StocksSupplied) AS TStockSup from SupplyTrans  group by ProductID) AS TotalStockFromSupplier


                    on TotalStocksSold.ProductID = TotalStocksSold.ProductID on NProduct.ProductID =TotalStocksSold.ProductID  on NSupplier.ProductID = NProduct.ProductID
                    Where NProduct.ProductID = TotalStockFromSupplier.ProductID






--Load Transaction History

Select NProduct.ProductID   ,  NProduct.ProductName, CheckoutID,NProduct.Price, TStockSold,
                NProduct.Price *  TotalStocksSold.TStockSold AS TotalSales
                from 
                (Select Products.ProductID, Supplier.CompanyName ,Supplier.SupplierID,Supplier.SupplierID AS TSupplier From SupplyTrans inner join Products
                 on Products.ProductID = SupplyTrans.ProductID  
                inner join Supplier on Supplier.SupplierID = SupplyTrans.SupplierID
               group by Products.ProductID, Supplier.CompanyName,Supplier.SupplierID,Supplier.SupplierID) AS NSupplier

                  inner join
                (Select ProductID, ProductName ,ProductCode, Price ,ItemDesc,Price As TProduct From Products group by ProductID, 
                  ProductName , ProductCode, Price,ItemDesc,Price) As NProduct


                 Inner join 
                (Select ProductID, CheckoutID , sum(StockSold) AS TStockSold from BuyingTransaction group by CheckoutID,ProductID) AS TotalStocksSold

                inner join  
                (Select ProductID, sum(StocksSupplied) AS TStockSup from SupplyTrans  group by ProductID) AS TotalStockFromSupplier

                on TotalStocksSold.ProductID = TotalStocksSold.ProductID on NProduct.ProductID =TotalStocksSold.ProductID   
                on NSupplier.ProductID = NProduct.ProductID  



	--Load Supplier
	
	SELECT SupplyTrans.SupplierID, Supplier.CompanyName , SupplyTrans.ProductID, ProductName 
	FROM SupplyTrans
	inner join Products on  SupplyTrans.ProductID = Products.ProductID
	inner join Supplier on SupplyTrans.SupplierID =  Supplier.SupplierID
	group by SupplyTrans.SupplierID, Supplier.CompanyName, SupplyTrans.ProductID, Products.ProductName	
             Where NProduct.ProductID = TotalStockFromSupplier.ProductID AND CheckoutID = CheckoutID




--Login
(
 SELECT CASE WHEN EXISTS 
(
SELECT * FROM Employee
WHERE Username = ''  AND Password = '') 
THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END
 )

(
 SELECT CASE WHEN EXISTS 
(
SELECT * FROM Employee
Where Username = '' AND Password = '' AND IsAdmin = 1)  
THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END
 )

 SELECT FirstName FROM Employee
 Where Username = '' AND Password = ''





